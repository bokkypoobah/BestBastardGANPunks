<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <title>BESTBASTARDGANPUNKS</title>

    <link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="css/bootstrap-vue.min.css"/>
    <link type="text/css" rel="stylesheet" href="css/bootstrap-vue-icons.min.css"/>

    <!-- Load polyfills to support older browsers -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver"></script>

    <script src="js/vue.js"></script>
    <script src="js/bootstrap-vue.min.js"></script>
    <script src="js/bootstrap-vue-icons.min.js"></script>
    <script src="js/dexie.js"></script>
    <script src="js/libgif.js"></script>

    <script src="js/ethers-5.2.umd.min.js"></script>
    <script src="js/bignumber.min.js"></script>
    <!-- <script src="js/apexcharts.js"></script> -->

    <!-- ENS stuff -->
    <script src="js/punycode.js"></script>
    <script src="js/idna-map.js"></script>
    <script src="js/idna-uts46-hx.js"></script>
    <script src="js/js-sha3.js"></script>
    <script src="js/eth-ens-namehash.js"></script>

    <script src="bastardData.min.js"></script>
    <script src="categories.js"></script>
    <script src="showcase.js"></script>
    <script src="deploymentData.js"></script>
    <script src="ensMapSnapshot.js"></script>
    <script src="ownersSnapshot.js"></script>

    <link rel="apple-touch-icon" sizes="57x57" href="images/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="images/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="images/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="images/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="images/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="images/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="images/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="manifest" href="images/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="images/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

  </head>
  <body>
    <div id="app">
      <b-container fluid class="m-0 p-1">
        <div>
          <b-navbar variant="light">
            <b-navbar-brand to="./" variant="primary" v-b-popover.hover.bottom="'Best Bastard GAN Punks'">
              BESTBASTARDGANPUNKS
            </b-navbar-brand>
            <div v-for="item in getHeaderBastards">
              <b-link @click="displayToken(item)">
                <b-avatar rounded="sm" variant="light" size="3.0rem" :src="data[item] ? data[item].images[0] : null" v-b-popover.hover.bottom="'#' + item" class="ml-2"></b-avatar>
              </b-link>
            </div>
            <b-navbar-nav class="ml-auto">
              <b-button size="sm" variant="outline-primary" class="ml-4" v-b-popover.hover="'CONNECT TO SEE YOUR BASTARDS'" @click="connect();" v-if="!connected">CONNECT WALLET</b-button>
              <b-button size="sm" variant="outline-primary" class="ml-4" v-b-popover.hover="'DISCONNECT TO SEE BOKKY\'S BASTARDS'" @click="disconnect();" v-if="connected">{{ ensOrShortName(account) }}</b-button>
            </b-navbar-nav>
          </b-navbar>
        </div>

        <div>
          <b-card no-body class="mt-1">
            <div>
              <!-- <b-modal size="xl" ref="gif-frame-extraction-modal" hide-footer @shown="onGIFFrameSelectionModalOpened" class="w-100"> -->
              <b-modal ref="gif-frame-extraction-modal" hide-footer @shown="onGIFFrameSelectionModalOpened" dialog-class="mw-100 w-50">
                <template #modal-title>
                  {{ selectedTokenId == null ? null : data[selectedTokenId].name }}
                  <span v-if="selectedItemIsGIF"> - Frame {{ selectedItemFrame == null ? '(loading)' : selectedItemFrame }}</span>
                </template>
                <div class="d-block text-center">
                  <img id="thegif1" :src="selectedTokenId != null && data[selectedTokenId] ? data[selectedTokenId].images[0] : null" :rel:animated_src="selectedTokenId && data[selectedTokenId] ? data[selectedTokenId].images[0] : null" width="600" height="600" rel:auto_play="0" rel:rubbable="1" class="pr-3" />
                </div>
                <b-input-group v-if="selectedItemIsGIF">
                  <template #prepend>
                    <b-form-spinbutton wrap @change="setFrame()" v-model.trim="selectedItemFrame" min="0" :max="selectedItemFrames == null ? 0 : (selectedItemFrames - 1)" class="mr-2"></b-form-spinbutton>
                    <b-input-group-text>0</b-input-group-text>
                  </template>
                  <b-form-input @change="setFrame()" v-model.trim="selectedItemFrame" type="range" min="0" :max="selectedItemFrames == null ? 0 : (selectedItemFrames - 1)" class="w-25"></b-form-input>
                  <template #append>
                    <b-input-group-text>{{ selectedItemFrames == null ? 0 : (selectedItemFrames - 1) }}</b-input-group-text>
                  </template>
                </b-input-group>
              </b-modal>
            </div>

            <template>
              <div>
                <b-sidebar right id="sidebar-border" sidebar-class="border-right border-danger">
                  <div v-for="(categoryKey, categoryIndex) in Object.keys(categories).sort()" v-bind:key="categoryIndex">
                    <b-card body-class="p-0" header-class="m-0 p-0 pl-2" footer-class="p-1" class="m-3 p-0">
                      <template #header>
                        <span variant="secondary" class="small truncate">
                          {{ categoryKey }}
                        </span>
                      </template>
                      <font size="-2">
                        <b-table small fixed striped sticky-header="200px" :fields="categoryFields" :items="getSortedValuesForCategory(categoryKey)" head-variant="light">
                          <template #cell(select)="data">
                            <b-form-checkbox @change="filterChange(categoryKey, data.item.categoryOption)"></b-form-checkbox>
                          </template>
                        </b-table>
                      </font>
                    </b-card>
                  </div>
                </b-sidebar>
              </div>
            </template>

            <div v-if="processing == null && settings.searchAccount != null && settings.searchAccount.length > 0 && collatedOwners.length == 0">
              <b-jumbotron header="WEB3 CONNECTION REQUIRED" bg-variant="info" text-variant="white" border-variant="dark" class="m-5 p-5">
                TO RETRIEVE ERC-721 TOKEN OWNERSHIP AND ENS INFOMRATION. YOU CAN CONTINUE USING THIS TOOL WITHOUT A CONNECTION BUT OWNER INFORMATION AND SEARCH WILL NOT WORK. CLICK ON THE BUTTON ON THE TOP RIGHT TO CONNECT. CLEAR THE OWNER SEARCH FIELD TO REMOVE THIS MESSAGE.
              </b-jumbotron>
            </div>

            <div v-if="processing != null">
              <b-jumbotron header="PROCESSING" bg-variant="info" text-variant="white" border-variant="dark" class="m-5 p-5">
                {{ processing }}
              </b-jumbotron>
            </div>

            <b-tabs card v-model="tabIndex" align="right">

              <b-tab title="SEXY BASTARDS">
                <b-card-text>
                  <div class="d-flex m-0 p-0" style="height: 37px;">
                    <div>
                      <b-form-input type="text" size="sm" @change="recalculate('searchTokenId')" v-model.trim="settings.searchTokenId" debounce="600" placeholder="🔍 ID1, ID2-ID3, ..."></b-form-input>
                    </div>
                    <div class="pl-1">
                      <b-form-input type="text" size="sm" @change="recalculate('searchAccount')" v-model.trim="settings.searchAccount" debounce="600" placeholder="🔍 ENS1, ADDY2, ..."></b-form-input>
                    </div>
                    <div class="pl-1">
                      <b-button size="sm" :pressed.sync="settings.mySexyBastards" @click="recalculate('searchAccount')" variant="outline-primary" v-b-popover.hover="'VIEW ONLY MY SEXY BASTARDS'">MY SEXY BASTARDS</b-button>
                    </div>
                    <div class="pl-1">
                      <b-button size="sm" :pressed.sync="settings.advancedSearch" @click="saveSettings('advancedSearch')" variant="outline-primary" v-b-popover.hover="'ADVANCED SEARCH'"><span v-if="settings.advancedSearch"><b-icon-chevron-double-up shift-v="+1" font-scale="1.0"></b-icon-chevron-double-up></span><span v-else><b-icon-chevron-double-down shift-v="+1" font-scale="1.0"></b-icon-chevron-double-down></span></b-button>
                    </div>
                    <div class="pr-1 flex-grow-1">
                    </div>
                    <div class="pl-1">
                      <font size="-2">{{ tokensSearchResults.length }}/{{ getTotalSupply }}</font>
                    </div>
                    <div class="pl-1">
                      <b-pagination size="sm" v-model="tokensCurrentPage" :total-rows="tokensSearchResults.length" :per-page="tokensPageSize"></b-pagination>
                    </div>
                    <div class="pl-1">
                      <b-form-input type="text" size="sm" v-model.trim="tokensCurrentPage" debounce="600" class="w-25"></b-form-input>
                    </div>
                    <div class="pl-1">
                      <b-form-select size="sm" v-model="tokensPageSize" :options="pageSizes"></b-form-select>
                    </div>
                    <div class="pl-1" v-if="settings.cardView">
                      <b-form-select size="sm" v-model="cardImageSizeCurrent" :options="cardImageSizeOptions"></b-form-select>
                    </div>
                    <div class="pl-1">
                      <b-button size="sm" :pressed.sync="settings.cardView" @click="saveSettings('cardView')" variant="link" v-b-popover.hover="'LIST OR CARD VIEW'"><span v-if="settings.cardView"><b-icon-list-ol shift-v="+1" font-scale="1.0"></b-icon-list-ol></span><span v-else><b-icon-grid3x3-gap shift-v="+1" font-scale="1.0"></b-icon-grid3x3-gap></span></b-button>
                      <b-button size="sm" v-b-toggle.sidebar-border variant="link" v-b-popover.hover="'ADVANCED SERACH'" class="m-0 p-0"><b-icon-search shift-v="+.5" font-scale="1.2"></b-icon-search></b-button>
                    </div>
                  </div>

                  <div>
                    <!-- visible -->
                    <b-collapse v-model="settings.advancedSearch" class="m-2">
                      <b-card>
                        <b-card-group deck>
                          <b-card header="QUICK FILTER" style="min-width: 18rem; max-width: 18rem;" class="mb-2">
                            <b-card-text>
                              <b-form-input type="text" size="sm" @change="recalculate('searchTokenId')" v-model.trim="settings.searchTokenId" debounce="600" placeholder="🔍 ID1, ID2-ID3, ..." class="mb-2"></b-form-input>
                              <b-form-input type="text" size="sm" @change="recalculate('searchAccount')" v-model.trim="settings.searchAccount" debounce="600" placeholder="🔍 ENS1, ADDY2, ..." class="mb-2"></b-form-input>
                              <b-form-input type="text" size="sm" @change="recalculate('searchLyrics')" v-model.trim="settings.searchLyrics" debounce="600" placeholder="🔍 LYRICS" class="mb-2"></b-form-input>
                              <b-form-checkbox @change="recalculate('searchForSaleOnly')" v-model.trim="settings.searchForSaleOnly" debounce="600">For Sale Only (coming)</b-form-checkbox>
                            </b-card-text>
                          </b-card>
                          <b-card header="FILTER BY TAGS" style="min-width: 18rem; max-width: 18rem;" class="mb-2">
                            <b-card-text>
                              <b-form-select size="sm" @change="recalculate('selectedTags')" v-model="selectedTags" :options="getTags" multiple :select-size="10" variant="outline-primary"></b-form-select>
                            </b-card-text>
                          </b-card>
                          <b-card header="FILTER BY CATEGORIES" style="min-width: 18rem; max-width: 18rem;" class="mb-2">
                            <b-card-text>
                              <b-form-select size="sm" @change="recalculate('selectedCategories')" v-model="selectedCategories" :options="getCategories" multiple :select-size="10" variant="outline-primary"></b-form-select>
                            </b-card-text>
                          </b-card>
                          <b-card header="SELECTION TOOLS" style="min-width: 18rem; max-width: 18rem;" class="mb-2">
                            <b-card-text>
                              {{ getSelectedTokenIds }}<br />
                              <b-button size="sm" @click="copyCurrentFilteredResultsIntoSelection" variant="outline-primary" v-b-popover.hover="'COPY CURRENT FILTERED RESULTS INTO SELECTION'"><b-icon-caret-right-square shift-v="+1" font-scale="1.0"></b-icon-caret-right-square></b-button>
                              <b-button size="sm" @click="settings.selection = {}; saveSettings('resetSelection')" variant="outline-primary" v-b-popover.hover="'RESET SELECTION'"><b-icon-trash shift-v="+1" font-scale="1.0"></b-icon-trash></b-button>
                            </b-card-text>
                          </b-card>
                        </b-card-group>
                      </b-card>
                    </b-collapse>
                  </div>

                  <div v-if="settings.cardView">
                    <b-card-group deck>
                      <div v-for="record in pagedTokensResults">
                        <b-card body-class="p-1" header-class="p-1" footer-class="p-1" img-top class="m-1 p-0 border-0">
                          <b-link @click="displayToken(record.tokenId)" v-b-popover.hover="'CLICK FOR DETAILS'">
                            <b-img-lazy :width="cardImageSizeCurrent + '%'" :src="record.images[0]" />
                          </b-link>
                          <b-card-text>
                            <b-form-checkbox @input="saveSettings('cardViewSelection')" inline v-model="settings.selection[record.tokenId]">
                              <b-link :href="'https://www.bastardganpunks.club/v2/' + record.tokenId" v-b-popover.hover="'VIEW NFT IN ORIGNIAL WEBSHITE'" target="_blank">
                                {{ '#' + record.tokenId }}
                              </b-link>
                            </b-form-checkbox>
                            <b-link v-if="cardImageSizeCurrent >= 300" :href="'https://opensea.io/accounts/' + owners[record.tokenId]" v-b-popover.hover="'VIEW OWNER ACCOUNT IN OPENSEA'" target="_blank">
                              {{ ensOrShortName(owners[record.tokenId], 14) }}
                            </b-link>
                            <b-link v-if="cardImageSizeCurrent >= 300" size="sm" @click="settings.searchAccount = owners[record.tokenId]; tabIndex = 0; recalculate('tokenSearch'); " v-b-popover.hover="'FILTER BY OWNER ACCOUNT'" variant="link">
                              <b-icon-search shift-v="+1" font-scale="0.8"></b-icon-search>
                            </b-link>
                            <b-link v-if="cardImageSizeCurrent >= 300" :href="record.images[1]" v-b-popover.hover="'VIEW ORIGINAL IMAGE ON IPFS'" target="_blank">
                              <b-icon-image shift-v="+1" font-scale="0.8"></b-icon-image>
                            </b-link>
                            <b-link v-if="cardImageSizeCurrent >= 300" :href="record.images[2]" v-b-popover.hover="'VIEW ORIGINAL IMAGE ON ARWEAVE'" target="_blank">
                              <b-icon-image-fill shift-v="+1" font-scale="0.8"></b-icon-image-fill>
                            </b-link>
                            <b-link v-if="cardImageSizeCurrent >= 300" :href="'./arweaveimages/' + record.tokenId + '_' + record.images[2].replace('https://arweave.net/', '') + (record.imageMosaic != null ? '.gif' : '.png')" v-b-popover.hover="'VIEW SAVED COPY OF ORIGINAL ARWEAVE IMAGE'" target="_blank">
                              <b-icon-card-image shift-v="+1" font-scale="0.8"></b-icon-card-image>
                            </b-link>
                            <span v-if="record.mosaicurl != null && cardImageSizeCurrent >= 300">
                              <b-link :href="record.mosaicurl" v-b-popover.hover="'VIEW HYPED AF (ANIMATED) MOSAIC'" target="_blank">
                                <b-icon-grid3x3-gap shift-v="+1" font-scale="0.8"></b-icon-grid3x3-gap>
                              </b-link>
                            </span>
                            <b-link v-if="cardImageSizeCurrent >= 300" :href="record.permalink" target="_blank">
                              <span v-if="osData[record.tokenId] && osData[record.tokenId].sellOrder"><b-icon-cart-fill shift-v="+1" font-scale="0.8" v-b-popover.hover="'FOR SALE IN OPENSEA'"></b-icon-cart-fill></span><span v-else><b-icon-cart4 shift-v="+1" font-scale="0.8" v-b-popover.hover="'NOT FOR SALE IN OPENSEA'"></span>
                            </b-link>
                            <span v-if="cardImageSizeCurrent >= 300">
                              <font size="-2">
                                <b-form-tags size="sm" @input="saveTags" v-model="tags[record.tokenId]" tag-variant="primary" tag-pills separator=" " v-b-popover.hover="'ENTER NEW TAGS'" placeholder="" class="ml-0 mt-1 mw-100"></b-form-tags>
                              </font>
                            </span>
                          </b-card-text>
                        </b-card>
                      </div>
                    </b-card-group>
                  </div>

                  <div v-if="!settings.cardView">
                    <b-table small :fields="fields" :items="pagedTokensResults" responsive="sm">
                      <template #cell(image)="data">
                        <b-link @click="displayToken(data.item.tokenId)" v-b-popover.hover="'Click for details'">
                          <b-img-lazy width="300%" :src="data.item.images[0]" />
                        </b-link>
                      </template>
                      <template #cell(tokenId)="data">
                        <b-form-checkbox @input="saveSettings('listViewSelection')" inline v-model="settings.selection[data.item.tokenId]">
                          <b-link :href="'https://www.bastardganpunks.club/v2/' + data.item.tokenId" v-b-popover.hover="'VIEW NFT IN ORIGNIAL WEBSHITE'" target="_blank">
                            {{ '#' + data.item.tokenId }}
                          </b-link>
                        </b-form-checkbox>
                        <br />
                        <span v-if="owners.length > 0">
                          <b-link :href="'https://opensea.io/accounts/' + owners[data.item.tokenId]" v-b-popover.hover="'VIEW OWNER ACCOUNT IN OPENSEA'" target="_blank">
                            <font size="-2">{{ ensOrShortName(owners[data.item.tokenId]) }}</font>
                          </b-link>
                        </span>
                        <b-link size="sm" @click="settings.searchAccount = owners[data.item.tokenId]; tabIndex = 0; recalculate('tokenSearch'); " v-b-popover.hover="'FILTER BY OWNER ACCOUNT'" variant="link">
                          <b-icon-search shift-v="+1" font-scale="0.8"></b-icon-search>
                        </b-link>
                        <b-link :href="data.item.images[1]" v-b-popover.hover="'VIEW ORIGINAL IMAGE ON IPFS'" target="_blank">
                          <b-icon-image shift-v="+1" font-scale="0.8"></b-icon-image>
                        </b-link>
                        <b-link :href="data.item.images[2]" v-b-popover.hover="'VIEW ORIGINAL IMAGE ON ARWEAVE'" target="_blank">
                          <b-icon-image-fill shift-v="+1" font-scale="0.8"></b-icon-image-fill>
                        </b-link>
                        <b-link :href="'./arweaveimages/' + data.item.tokenId + '_' + data.item.images[2].replace('https://arweave.net/', '') + (data.item.imageMosaic != null ? '.gif' : '.png')" v-b-popover.hover="'VIEW SAVED COPY OF ORIGINAL ARWEAVE IMAGE'" target="_blank">
                          <b-icon-card-image shift-v="+1" font-scale="0.8"></b-icon-card-image>
                        </b-link>
                        <span v-if="data.item.imageMosaic != null">
                          <b-link :href="'hypedafmosaic/' + data.item.tokenId + '.png'" v-b-popover.hover="'VIEW HYPED AF (ANIMATED) MOSAIC'" target="_blank">
                            <b-icon-grid3x3-gap shift-v="+1" font-scale="0.8"></b-icon-grid3x3-gap>
                          </b-link>
                        </span>

                        <!--
                        TODO
                        <span>
                          <b-link :href="'????/' + data.item.tokenId + '.png'" v-b-popover.hover="'VIEW RAW DATA'" target="_blank">
                            <b-icon-file-text shift-v="+1" font-scale="0.8"></b-icon-file-text>
                          </b-link>
                        </span>
                        -->
                        <b-link :href="data.item.permalink" target="_blank">
                          <span v-if="osData[data.item.tokenId] && osData[data.item.tokenId].sellOrder"><b-icon-cart-fill shift-v="+1" font-scale="0.8" v-b-popover.hover="'FOR SALE IN OPENSEA'"></b-icon-cart-fill></span><span v-else><b-icon-cart4 shift-v="+1" font-scale="0.8" v-b-popover.hover="'NOT FOR SALE IN OPENSEA'"></b-icon-cart4></span>
                        </b-link>
                        <b-form-textarea size="sm" @change="saveNotes('listView')" v-model.trim="notes[data.item.tokenId]" placeholder="NOTES ..." rows="3" max-rows="10" class="ml-0 mt-1 mb-1"></b-form-textarea>
                        <b-form-tags size="sm" @input="saveTags" v-model="tags[data.item.tokenId]" tag-variant="primary" tag-pills size="sm" separator=" " v-b-popover.hover="'ENTER NEW TAGS'" placeholder="TAGS ..." class="ml-0 mt-1 mb-1"></b-form-tags>
                        <div v-if="osData[data.item.tokenId] && osData[data.item.tokenId].sellOrder">
                          <b-button size="sm" variant="warning" :href="data.item.permalink" v-b-popover.hover="'PURCHASE IN OPENSEA'" target="_blank" class="m-1 p-1">
                            <b-badge size="sm" variant="light">{{ formatETH(osData[data.item.tokenId].sellOrder.currentPrice) }}</b-badge>
                            {{ osData[data.item.tokenId].sellOrder.symbol }} <font size="-2">{{ formatDate(osData[data.item.tokenId].sellOrder.listingTime) }}</font>
                          </b-button>
                        </div>
                        <div v-if="osData[data.item.tokenId] && osData[data.item.tokenId].lastSale">
                          <b-button size="sm" variant="success" :href="'https://etherscan.io/tx/' + osData[data.item.tokenId].lastSale.tx" v-b-popover.hover="'VIEW PURCHASE IN BLOCK EXLPORER'" target="_blank" class="m-1 p-1">
                            <b-badge size="sm" variant="light">{{ formatETH(osData[data.item.tokenId].lastSale.totalPrice) }}</b-badge>
                            {{ osData[data.item.tokenId].lastSale.symbol }} <font size="-2">{{ formatDate(osData[data.item.tokenId].lastSale.eventTimestamp) }}</font>
                          </b-button>
                        </div>
                      </template>
                      <template #cell(description)="data">
                        <span v-for="line in data.item.description.split('\n')">
                          <b>{{ line }}</b><br />
                        </span>
                      </template>
                      <template #cell(attributes)="data">
                        <b-row v-for="(attribute, i) in data.item.attributes"  v-bind:key="i" class="m-0 p-0">
                          <b-col class="m-0 p-0"><font size="-3">{{ attribute.trait_type }}</font></b-col><b-col class="m-0 p-0"><b><font size="-2">{{ attribute.value }}</font></b></font></b-col>
                        </b-row>
                      </template>
                    </b-table>
                  </div>
                </b-card-text>
              </b-tab>

              <b-tab title="SHOWCASE">
                <b-card-text>
                  <div class="d-flex m-0 p-0" style="height: 37px;">
                    <div>
                      <b-form-select v-model="selectedShowcaseBastardsEvents" :options="getShowcaseBastardsEvents"></b-form-select>
                    </div>
                    <div class="pr-1 flex-grow-1">
                    </div>
                    <div class="pl-2">
                      <b-form-select size="sm" @input="saveSettings('sortOption')" v-model="settings.sortOption" :options="sortOptions"></b-form-select>
                    </div>
                    <div class="pl-2">
                      <b-form-select size="sm" v-model="cardImageSizeCurrent" :options="cardImageSizeOptions"></b-form-select>
                    </div>
                  </div>
                </b-card-text>
                <b-card-text>
                  <b-card-group deck>
                    <div v-for="record in getShowcaseBastards(selectedShowcaseBastardsEvents).tokenIds">
                      <b-card v-if="data[record]" body-class="p-1" header-class="p-1" footer-class="p-1" img-top class="m-1 p-0 border-0">
                        <b-card-text>
                          <b-link @click="displayToken(data[record].tokenId)" v-b-popover.hover="'CLICK FOR DETAILS'">
                            <b-img-lazy :width="cardImageSizeCurrent + '%'" :src="data[record].images[0]" />
                          </b-link>
                        </b-card-text>
                        <b-card-text>
                          <b-form-checkbox @input="saveSettings('cardViewSelection')" inline v-model="settings.selection[record]">
                            <b-link :href="'https://www.bastardganpunks.club/v2/' + record" v-b-popover.hover="'VIEW NFT IN ORIGNIAL WEBSHITE'" target="_blank">
                              {{ '#' + record }}
                            </b-link>
                          </b-form-checkbox>
                          <b-link v-if="cardImageSizeCurrent >= 300" :href="'https://opensea.io/accounts/' + owners[record]" v-b-popover.hover="'VIEW OWNER ACCOUNT IN OPENSEA'" target="_blank">
                            {{ ensOrShortName(owners[record], 15) }}
                          </b-link>
                          <b-link v-if="cardImageSizeCurrent >= 300" size="sm" @click="settings.searchAccount = owners[record]; tabIndex = 0; recalculate('tokenSearch'); " v-b-popover.hover="'FILTER BY OWNER ACCOUNT'" variant="link">
                            <b-icon-search shift-v="+1" font-scale="0.8"></b-icon-search>
                          </b-link>
                          <b-link v-if="cardImageSizeCurrent >= 300" :href="data[record].images[1]" v-b-popover.hover="'VIEW ORIGINAL IMAGE ON IPFS'" target="_blank">
                            <b-icon-image shift-v="+1" font-scale="0.8"></b-icon-image>
                          </b-link>
                          <b-link v-if="cardImageSizeCurrent >= 300" :href="data[record].images[2]" v-b-popover.hover="'VIEW ORIGINAL IMAGE ON ARWEAVE'" target="_blank">
                            <b-icon-image-fill shift-v="+1" font-scale="0.8"></b-icon-image-fill>
                          </b-link>
                          <b-link v-if="cardImageSizeCurrent >= 300" :href="'./arweaveimages/' + record + '_' + data[record].images[2].replace('https://arweave.net/', '') + (data[record].imageMosaic != null ? '.gif' : '.png')" v-b-popover.hover="'VIEW SAVED COPY OF ORIGINAL ARWEAVE IMAGE'" target="_blank">
                            <b-icon-card-image shift-v="+1" font-scale="0.8"></b-icon-card-image>
                          </b-link>
                          <span v-if="data[record].mosaicurl != null && cardImageSizeCurrent >= 300">
                            <b-link :href="data[record].mosaicurl" v-b-popover.hover="'VIEW HYPED AF (ANIMATED) MOSAIC'" target="_blank">
                              <b-icon-grid3x3-gap shift-v="+1" font-scale="0.8"></b-icon-grid3x3-gap>
                            </b-link>
                          </span>
                          <b-link v-if="cardImageSizeCurrent >= 300" :href="data[record].permalink" target="_blank">
                            <span v-if="osData[record] && osData[record].sellOrder"><b-icon-cart-fill shift-v="+1" font-scale="0.8" v-b-popover.hover="'FOR SALE IN OPENSEA'"></b-icon-cart-fill></span><span v-else><b-icon-cart4 shift-v="+1" font-scale="0.8" v-b-popover.hover="'NOT FOR SALE IN OPENSEA'"></span>
                          </b-link>
                          <span v-if="cardImageSizeCurrent >= 300">
                            <font size="-2">
                              <b-form-tags size="sm" @input="saveTags" v-model="tags[record]" tag-variant="primary" tag-pills separator=" " v-b-popover.hover="'ENTER NEW TAGS'" placeholder="" class="ml-0 mt-1 mw-100"></b-form-tags>
                            </font>
                          </span>
                        </b-card-text>
                      </b-card>
                    </div>
                  </b-card-group>
                </b-card-text>
              </b-tab>

              <b-tab title="SYNC DATA">
                <b-card-text>
                  <b-button size="sm" @click="loadOSData()" variant="outline-primary">
                    SYNC OPENSEA SALES AND LISTINGS DATA
                  </b-button>
                </b-card-text>
                <b-card-text>
                   TAKES ~ 6 MINUTES. YOU CAN CONTINUE BROWSING THE BEAUTIFUL BASTARDS WHILE THIS PROCESS RUNS IN THE BACKGROUND.
                </b-card-text>
              </b-tab>

              <b-tab lazy title="OWNERS">
                <b-card-text>
                  <div class="d-flex m-0 p-0" style="height: 37px;">
                    <div class="pr-1 flex-grow-1">
                    </div>
                    <div class="pl-2">
                      <font size="-2">Unique Owners: {{ collatedOwners.length }} ({{ ((collatedOwners.length*100)/getTotalSupply).toFixed(2) + '%' }}); Total Supply: {{ getTotalSupply }}. Connect your wallet to retrieve up-to-date owner data</font>
                    </div>
                    <div class="pl-2">
                      <b-pagination size="sm" v-model="ownersCurrentPage" :total-rows="collatedOwners.length" :per-page="ownersPageSize"></b-pagination>
                    </div>
                    <div class="pl-2">
                      <b-form-select size="sm" v-model="ownersPageSize" :options="pageSizes"></b-form-select>
                    </div>
                  </div>

                  <b-table small :fields="ownersFields" :items="pagedCollatedOwnersResults" responsive="sm">
                    <template #cell(index)="data">
                      {{ data.item.index }}
                    </template>
                    <template #cell(owner)="data">
                      {{ ensOrShortName(data.item.owner) }}<br />
                      {{ data.item.tokens.length + ' (' + (data.item.tokens.length*100/getTotalSupply).toFixed(2) + '%)'}}<br />
                      <b-link :href="'https://opensea.io/accounts/' + data.item.owner + '?search[sortAscending]=false&search[sortBy]=LAST_TRANSFER_DATE'" v-b-popover.hover="'VIEW OWNER ACCOUNT IN OPENSEA'" target="_blank">
                         <b-icon-link shift-v="+1" font-scale="1.0"></b-icon-link>
                      </b-link>
                      <b-link size="sm" @click="settings.searchAccount = data.item.owner; tabIndex = 0; recalculate('ownerSearch'); " variant="outline-primary" v-b-popover.hover="'FILTER BY OWNER ACCOUNT'" >
                        <b-icon-search shift-v="+1" font-scale="1.0"></b-icon-search>
                      </b-link>
                    </template>
                    <template #cell(tokens)="data">
                      <span v-for="tokenId in data.item.tokens">
                        <b-link :href="'https://opensea.io/assets/0x31385d3520bced94f77aae104b406994d8f2168c/' + tokenId" v-b-popover.hover="'VIEW #' + tokenId + ' IN OPENSEA'" target="_blank">
                          <b-img-lazy :width="'60%'" :src="getImagePreview(tokenId)" />
                        </b-link>
                      </span>
                    </template>
                  </b-table>
                </b-card-text>
              </b-tab>

              <b-tab lazy title="CATEGORIES">
                <b-card-text>
                  <b-table small striped :items="getTokenIdsByCategories" head-variant="light">
                    <template #cell(tokenIds)="data">
                      <span v-for="tokenId in data.item.tokenIds">
                        <b-link :href="'https://opensea.io/assets/0x31385d3520bced94f77aae104b406994d8f2168c/' + tokenId" v-b-popover.hover="'VIEW #' + tokenId + ' IN OPENSEA'" target="_blank">
                          <b-img-lazy :width="'60%'" :src="getImagePreview(tokenId)" />
                        </b-link>
                      </span>
                    </template>
                  </b-table>
                </b-card-text>
                <b-card-text>
                  Maintained in <a href="https://github.com/bokkypoobah/BestBastardGANPunks/blob/main/docs/categories.js" target="_blank">https://github.com/bokkypoobah/BestBastardGANPunks/blob/main/docs/categories.js</a>. Submit PR or ping changes to <a href="https://twitter.com/BokkyPooBah" target="_blank">@BokkyPooBah</a>.
                </b-card-text>
              </b-tab>

              <b-tab title="SETTINGS">
                <b-card-text>
                  <div class="d-flex m-0 p-0" style="height: 15px;">
                    <div class="pr-1 flex-grow-1">
                    </div>
                    <div class="pl-2">
                      <b-button size="sm" @click="newGroup('action')" variant="link" v-b-popover.hover="'ADD NEW GROUP'" class="m-0 p-0"><b-icon-plus shift-v="-1" font-scale="1.0"></b-icon-plus></b-button>
                    </div>
                  </div>
                </b-card-text>
                <b-card-text v-if="groups.length == 0">
                  <h6>CLICK + TO ADD A NEW GROUP</h6>
                </b-card-text>
                <div v-for="(group, groupIndex) in groups">
                  <b-card body-class="p-1" header-class="p-1" footer-class="p-1" class="m-1 mb-3 p-0">
                    <template #header>
                      <h6 class="mb-0"><b-button size="sm" :pressed.sync="group.active" @click="saveGroups('active')" variant="link" v-b-popover.hover="'ENABLE OR DISABLE IN FILTERS'"><span v-if="group.active"><b-icon-check-square-fill shift-v="+1" font-scale="1.0"></b-icon-check-square-fill></span><span v-else><b-icon-x-square shift-v="+1" font-scale="1.0"></b-icon-x-square></span></b-button>{{ groupIndex+1 }}. {{ group.name }} <b-button size="sm" class="float-right m-0 p-0" @click="deleteGroup(data.index)" variant="link" v-b-popover.hover="'DELETE GROUP'"><b-icon-trash shift-v="+1" font-scale="1.0"></b-icon-trash></b-button></h6>
                    </template>
                    <b-card-text>
                      <b-form-group label-cols="3" content-cols="9" label="GROUP NAME" class="m-0 p-0">
                        <b-form-input type="text" size="sm" @change="saveGroups('group.name')" v-model.trim="group.name" debounce="600" placeholder="GROUP NAME"></b-form-input>
                      </b-form-group>
                      <b-form-group label-cols="3" content-cols="9" label="NOTES" class="m-0 p-0">
                        <b-form-textarea size="sm" @change="saveGroups('group.notes')" v-model.trim="group.notes" placeholder="NOTES..." rows="3" max-rows="6"></b-form-textarea>
                      </b-form-group>
                    </b-card-text>
                    <b-card-text>
                      <b-table small striped hover :fields="accountsFields" :items="group.accounts" responsive="sm"  show-empty>
                        <template #cell(active)="data">
                          <b-button size="sm" :pressed.sync="data.item.active" @click="saveGroups('active')" variant="link" v-b-popover.hover="'ENABLE OR DISABLE IN FILTERS'"><span v-if="data.item.active"><b-icon-check-square-fill shift-v="+1" font-scale="1.0"></b-icon-check-square-fill></span><span v-else><b-icon-x-square shift-v="+1" font-scale="1.0"></b-icon-x-square></span></b-button>
                        </template>
                        <template #cell(name)="data">
                          <b-form-input type="text" size="sm" @change="saveGroups('accountName')" v-model.trim="data.item.name" debounce="600" placeholder="NAME"></b-form-input>
                        </template>
                        <template #cell(account)="data">
                          <b-input-group>
                            <b-form-input type="text" size="sm" @change="saveGroups('account')" v-model.trim="data.item.account" debounce="600" placeholder="0x12AbC..."></b-form-input>
                            <template #append>
                              <b-button size="sm" @click="data.item.account = account; saveGroups('filleWithAccount')" v-b-popover.hover="'FILL WITH CURRENT WEB3 ACCOUNT ' + account"><b-icon-chevron-double-left shift-v="+1" font-scale="1.0"></b-icon-chevron-double-left></b-button>
                            </template>
                          </b-input-group>
                        </template>
                        <template #cell(filterInOut)="data">
                          <b-form-select size="sm" v-model="data.item.filterInOut" :options="filterOptions"></b-form-select>
                        </template>
                        <template #cell(filter)="data">
                          <b-form-input type="text" size="sm" :disabled="data.item.filterInOut == null" @change="saveGroups('account')" v-model.trim="data.item.filter" debounce="600" placeholder="ID1, ID2-ID3, ..."></b-form-input>
                        </template>
                        <template #cell(action)="data">
                          <b-button size="sm" @click="deleteAccount(group, data.index)" variant="link" v-b-popover.hover="'DELETE ROW'"><b-icon-trash shift-v="+1" font-scale="1.0"></b-icon-trash></b-button>
                        </template>
                        <template #head(action)="data">
                          <b-button size="sm" @click="newAccount(group)" variant="link" v-b-popover.hover="'ADD NEW LINE'"><b-icon-plus shift-v="-1" font-scale="1.0"></b-icon-plus></b-button>
                        </template>
                        <template #empty="scope">
                          <h6>CLICK + TO ADD A NEW ACCOUNT</h6>
                        </template>
                      </b-table>
                    </b-card-text>
                  </b-card>
                </div>
              </b-tab>

              <b-tab title="INFO">
                <h6 class="mb-1">WHAT IS THIS WEBSHITE ABOUT?</h6>
                <b-card-text>
                  A SMOL WEB3 APP TO VIEW YOUR BASTARD GAN PUNKS FROM <a href="https://www.bastardganpunks.club/" target="_blank">https://www.bastardganpunks.club/</a>. OPEN SAUCED CODE IS AVAILBLE FOR YOUR TO IMPROVE ON - SEE BELOW.

                  THIS SITE CURRENTLY LISTS BGANPUNKV2 (VERSION 2) NFTS, NOT BGANPUNKV1 (VERSION 1) <a href="https://bganpunks.eth.link/" target="_blank">https://bganpunks.eth.link/</a>.

                  READ MORE ABOUT BGANPUNKS AT <a href="https://mooncat888.medium.com/introduction-to-bastard-gan-punk-v2-nft-art-collection-c5bb0750432c" target="_blank">Introduction to Bastard Gan Punk V2 NFT art collection</a> and <a href="https://everipedia.org/wiki/lang_en/bastard-gan-punks" target="_blank">Bastard Gan Punks</a>.
                </b-card-text>

                <b-card-text>
                  WER ARE NOT AFFILIATED WITH <a href="https://twitter.com/bganpunks" target="_blank">THESE BASTARDS</a> WITH A SANDWICH LOGO. IF YOU HAVE QUESTIONS, HEAD OVER TO THEIR DISCORD, LINEKD FROM THE URLS ABOVE.
                  <b-card no-body img-src="images/Twitter_bganpunks.png" style="max-width: 20rem;" class="mt-1 ml-5"></b-card>
                </b-card-text>

                <b-card-text>
                  NFT AND IMAGE COPYRIGHT INFO SEE <a href="https://www.bastardganpunks.club/#nftownership" target="_blank">https://www.bastardganpunks.club/#nftownership</a>.

                  A COPY OF THE <a href="https://drive.google.com/drive/folders/1dLnTSUhDlgfdUlzwm1pamiAWUyGVOGj-" target="_blank">HYPED AF MOSAICS</a> HAS BEEN INCLUDED WITH THIS WEBSHITE TO ORGANISE FOR EASIER ACCESS. ONLY THE HYPED AF (ANIMATED) MOSAICS IN THE FIRST 9,000 (#0 to #8,999) TOKENS HAVE BEEN ORGANISED AND THIS REPOSITORY WILL HAVE TO BE UPDATED WHEN THE ORGANISED MOSAICS ARE FINALLY PUBLISHED.
                </b-card-text>

                <h6 class="mt-4 mb-1">HOW DO I ADOPT SOME BASTARDS?</h6>
                <b-card-text>
                  THE LAST BASTARD WAS MINTED (SEE BELOW) AT <a href="https://etherscan.io/tx/0x8540f856b6db0eab792fda749730865a10178260da06541c84cf585d8dc60592" target="_blank">Jun-25-2021 04:53:13 PM +UTC</a> THROUGH A PROXY CONTRACT AND THERE ARE NO MORE BASTARDS TO ADOPT.

                  BGANPUNKV2 NFTS CAN BE PURCHASED FROM SECONDARY ERC-721 MARKETS SUCH AS <a href="https://opensea.io/collection/bastard-gan-punks-v2" target="_blank">https://opensea.io/collection/bastard-gan-punks-v2</a>.

                  SEE ALSO <a href="https://allbastards.com/" target="_blank">https://allbastards.com/</a> and <a href="https://nftexp.io/explore/bastard-gan-punks-v2" target="_blank">https://nftexp.io/explore/bastard-gan-punks-v2</a> FOR MORE INFROMATION.

                  THIS IS NOT FINANCIAL ADVICE. DO YOUR OWN FUCKING RESEARCH. DISCLOSURE - I HAVE SOME BGANPUNKS.
                </b-card-text>

                <h6 class="mt-4 mb-1">CONTRACT DETAILS</h6>
                <b-card-text>
                  THE BGANPUNV2 NFT SMART CONTRACT AT <a href="https://etherscan.io/address/0x31385d3520bCED94f77AaE104b406994D8F2168C#code" target="_blank">0x31385d3520bCED94f77AaE104b406994D8F2168C</a>:
                  <ul>
                    <li>WAS DEPLOYED AT <a href="https://etherscan.io/tx/0xd875fb294bf841eaf7bffae94bd5488d78f227e9b4a3017105bae31b296419ce" target="_blank">Mar-07-2021 12:03:56 PM +UTC</a> WHERE TOKENS #0 TO 33 WERE MINTED</li>
                    <li>MINTED THE FINAL TOKEN #11,304 AT <a href="https://etherscan.io/tx/0x8540f856b6db0eab792fda749730865a10178260da06541c84cf585d8dc60592" target="_blank">Jun-25-2021 04:53:13 PM +UTC</a> THROUGH A PROXY CONTRACT WITH A DECLINING PRICE</li>
                  </ul>
                  <b-card img-src="images/EtherScan_BGANPUNKSV2_20210703_2211.png" style="max-width: 40rem;" class="ml-5">
                    <b-card-text>
                      ETHERSCAN'S <a href="https://etherscan.io/token/tokenholderchart/0x31385d3520bced94f77aae104b406994d8f2168c" target="_blank">BASTARD GAN PUNKS V2 TOKEN HOLDERS @ Jul 3 2021</a>
                    </b-card-text>
                  </b-card>
                </b-card-text>

                <h6 class="mt-4 mb-1">ABOUT THIS APP</h6>
                <b-card-text>
                  <ul>
                    <li>SOURCE CODE AVAILABLE AT <a href="https://github.com/bokkypoobah/BestBastardGANPunks" target="_blank">https://github.com/bokkypoobah/BestBastardGANPunks</a>. CLONE IT, FORK IT. CONTRIBUTE ANY USEFUL CHANGES BACK TO THIS MAIN REPOSITORY.</li>
                    <li>THE MAIN BIT OF CODE IS IN <a href="https://github.com/bokkypoobah/BestBastardGANPunks/blob/main/docs/index.html#L416" target="_blank">https://github.com/bokkypoobah/BestBastardGANPunks/blob/main/docs/index.html</a>.</li>
                    <li>TO SEE HOW IT WORKS, SWITCH TO YOUR WEB BEOWSER DEVELOPER CONSOLE AND TRY STRPPING THROUGH THE SOURCE CODE.</li>
                    <li>WRITTEN USING THE <a href="https://bootstrap-vue.org/" target="_blank">https://bootstrap-vue.org/</a> FRAMEWWORK</li>
                    <li>GENERATES "STATIC" DATA BY COLLATING INFOTMSTION FROM THE TOKEN CONTACT'S <em>tokenURI(...)</em> INFORMATION WITH THE INFOTRMATION FROM OPENSEA.IO.</li>
                    <li>USES <a href="https://github.com/ethers-io/ethers.js/" target="_blank">ETHERS.JS</a> TO CONNECT TO ETHERUEM VIA WEB3 TO RETRIEVE NFT TOKENS OWNED</li>
                    <li>HAS NO TRACKIING TECHNOLOGY. HOWEVER CONNECTIONS FROM THIS APP TO OPENSEA AND YOUR WEB3 PROVIDER WILL LEAK SOME INFORMATION.</li>
                    <li>CAN BE RUN ON YOUR OWN COMPUTER BY CLONING THE GITHUB REPOSITORY AND SERVING THE PAGES USING A WEBSERVER, OR THE "ANYWHERE" SERVER.</li>
                    <li>CAN BE RUN FROM GITHUB PAGES, SO YOU CAN EASILY CLONE, CUSTOMISE AND SERVE YOUR OWN VERSION</li>
                    <!-- <li>HAS SOME CODE FROM THE IS IT CLEAN TOOL BY <a href="https://twitter.com/yungwknd" target="_blank">@yungwknd</a></li> -->
                  </ul>
                </b-card-text>

                <h6 class="mt-4 mb-1">SUPPORT A POOR DEVLOPER BASTARD</h6>
                <b-card-text>
                  <ul>
                    <li>SEND YOUR FUCKING DONATIONS TO BokkyPooBah.eth. FLOOR BGANPUNKV2S, NFTS, ETH AND ERC20S ALL APPRECIATED. DON'T BE A FUCKING STINGY BASTARD!!!</li>
                  </ul>
                </b-card-text>

                <b-card-text class="ml-5 mt-5">
                  ENJOY!
                  <b-card no-body img-src="images/DoomedDegen.png" style="max-width: 20rem;" class="mt-1 ml-2"></b-card>
                  (C) BOKKYPOOBAH / BOK CONSULTING PTY LTD 2021. THE MIT LICENCE.
                </b-card-text>
              </b-tab>
            </b-tabs>
          </b-card>
        </div>
      </b-container>
    </div>

    <script>
      window.app = new Vue({
        el: '#app',
        data: {
          processing: null,
          connected: false,
          account: null,
          groups: [ ],
          tokensOwned: [],
          owners: [],
          ensMap: {},
          osData: {},
          notes: {},
          tags: {},
          selectedTags: [],
          selectedCategories: [],
          collatedOwners: [],
          tabIndex: 0,
          selectedShowcaseBastardsEvents: 0,

          data: [],
          categories: {},

          settings: {
            mySexyBastards: false,
            advancedSearch: false,
            cardView: false,
            searchTokenId: '',
            searchLyrics: '',
            searchAccount: '',
            searchForSaleOnly: false,
            selection: {},
            sortOption: 'tokenIdAscending',
            display: {
              owner: true,
              // record.images = [osData.image_url, record.image, record.imageArweave, osData.image_preview_url, osData.image_thumbnail_url];
              imageSource: null, // 0 = OSImages, IPFSImage, ArweaveImage, OSPreview, OSThumbnail, GH
              imagesLinks: true,
              notes: true,
              tags: true,
              osLink: true,
            }
          },

          tokensSearchResults: [],

          tokensCurrentPage: 1,
          tokensPageSize: 100,
          ownersCurrentPage: 1,
          ownersPageSize: 10,

          pageSizes: [
            { value: 10, text: '10/P' },
            { value: 100, text: '100/P' },
            { value: 500, text: '500/P' },
            { value: 1000, text: '1,000/P' },
            { value: 2145, text: '2,145/P' },
            { value: 66666, text: 'ALL' },
          ],

          selectedTokenId: null,
          selectedItemFrame: 0,
          selectedItemFrames: null,
          selectedItemIsGIF: false,
          selectedItemGIF: null,

          cardImageSizeCurrent: '300',
          cardImageSizeOptions: [
            { value: '93', text: '93%' },
            { value: '115', text: '115%' },
            { value: '240', text: '240%' },
            { value: '300', text: '300%' },
            { value: '500', text: '500%' },
            { value: '750', text: '750%' },
            { value: '1000', text: '1,000%' },
            { value: '1500', text: '1,500%' },
            { value: '3000', text: '3,000%' },
            { value: '6000', text: '6,000%' },
            { value: '12000', text: '12,000%' },
          ],

          filterOptions: [
            { value: null, text: 'Inactive' },
            { value: 'in', text: 'Include' },
            { value: 'out', text: 'Exclude' },
          ],
          accountsFields: [
            { key: 'active', label: 'ACTIVE?', thStyle: 'width: 5%;', sortable: true },
            { key: 'name', label: 'NAME', thStyle: 'width: 20%;' },
            { key: 'account', label: 'ACCOUNT', thStyle: 'width: 35%;', sortable: true },
            { key: 'filterInOut', label: 'FILTER?', thStyle: 'width: 10%;', sortable: true },
            { key: 'filter', label: 'FILTER', thStyle: 'width: 25%;', sortable: true },
            { key: 'action', label: '' },
          ],
          categoryFields: [
            { key: 'select', label: '', thStyle: 'width: 10%;' },
            { key: 'categoryOption', label: 'TYPE', sortable: true },
            { key: 'categoryTotal', label: 'COUNT', sortable: true, thStyle: 'width: 30%;', thClass: 'text-right', tdClass: 'text-right' },
          ],
          categoryFilter: {},
          fields: [
            { key: 'image', label: 'BASTARD', thStyle: 'width: 25%;' },
            { key: 'tokenId', label: 'INFO', thStyle: 'width: 25%;' },
            { key: 'attributes', label: 'ATTRIBUTES', thStyle: 'width: 25%;' },
            { key: 'description', label: 'LYRICS', thStyle: 'width: 25%;' },
          ],
          sellOrdersFields: [
            { key: 'eth', label: 'ETH' },
            { key: 'created', label: 'LISTED' },
          ],
          ownersFields: [
            { key: 'index', label: '#' },
            { key: 'owner', label: 'OWNER' },
            { key: 'tokens', label: 'TONKENS' },
          ],
          sortOptions: [
            { value: 'tokenIdAscending', text: 'TOKENID ASCENDING' },
            { value: 'tokenIdDescending', text: 'TOKENID DESCENDING' },
            { value: 'random', text: 'RANDOM' },
          ],
          bokkysBastards: [471, 1133, 1147, 1197, 1322, 1406, 1822, 1835, 2289, 2893, 3053, 3291, 3316, 3569, 3852, 3905, 3906, 4046, 4087, 4113, 4158, 4209, 4272, 4618, 4777, 4793, 4994, 5288, 5601, 5654, 5710, 5775, 5903, 6225, 6285, 6626, 6632, 7008, 7214, 7222, 7266, 7432, 7492, 7567, 7721, 7731, 7776, 7831, 7850, 8621, 8645, 8854, 8895, 9040, 9158, 9260, 9362, 9374, 9401, 9490, 9594, 9595, 9740, 9759, 9783, 9792, 9881, 10050, 10093, 10178, 10192, 10193, 10252, 10341, 10375, 10449, 10456, 10564, 10583, 10592, 10661, 10724, 10727, 10729, 10734, 10735, 10736, 10737, 10834, 11100, 11105, 11140, 11258],
        },


        computed: {
          getSelectedTokenIds() {
            const results = [];
            for (const key of Object.keys(this.settings.selection)) {
              const value = this.settings.selection[key];
              if (value) {
                results.push(parseInt(key));
              }
            }
            results.sort(function(a, b) {
              return a - b;
            });
            return results;
          },
          getTotalSupply() {
            return this.data.length;
          },
          pagedTokensResults() {
            return this.tokensSearchResults.slice((this.tokensCurrentPage - 1) * this.tokensPageSize, this.tokensCurrentPage * this.tokensPageSize);
          },
          pagedCollatedOwnersResults() {
            return this.collatedOwners.slice((this.ownersCurrentPage - 1) * this.ownersPageSize, this.ownersCurrentPage * this.ownersPageSize);
          },
          getHeaderBastards() {
            const MAXBASTARDSTODISPLAY = 14;
            let tokenIdsOwned = this.tokensOwned.slice(0);
            if (tokenIdsOwned.length == 0) {
              tokenIdsOwned = this.bokkysBastards.slice(0);
            }
            tokenIdsOwned.sort(() => {
              return Math.random() - 0.5;
            });
            return tokenIdsOwned.slice(0, MAXBASTARDSTODISPLAY);
          },
          getShowcaseBastardsEvents() {
            const results = [];
            for (let i in SHOWCASE) {
              results.push({ value: i, text: SHOWCASE[i].event });
            }
            return results;
          },
          getTags() {
            const collator = {};
            for (const [key, value] of Object.entries(this.tags)) {
              for (let i = 0; i < value.length; i++) {
                const tag = value[i];
                if (!collator[tag]) {
                  collator[tag] = 1;
                } else {
                  collator[tag] = parseInt(collator[tag]) + 1;
                }
              }
            }
            let results = [];
            for (const [key, value] of Object.entries(collator)) {
              results.push({ value: key, text: key + ' (' + value + ')' });
            }
            results.sort(function(a, b) {
              return a.value.localeCompare(b.value);
            });
            results.unshift({ value: null, text: '(All)' });
            return results;
          },
          getCategories() {
            let results = [];
            for (const record of CATEGORIES) {
              results.push({ value: record.category, text: record.category + ' (' + record.tokenIds.length + ')' });
            }
            results.sort(function(a, b) {
              return a.value.localeCompare(b.value);
            });
            results.unshift({ value: null, text: '(All)' });
            return results;
          },
          getTokenIdsByCategories() {
            let results = [];
            for (const record of CATEGORIES) {
              results.push({ category: record.category, tokenIds: record.tokenIds });
            }
            results.sort(function(a, b) {
              return a.category.localeCompare(b.category);
            });
            return results;
          },
        },


        methods: {
          getShowcaseBastards(index) {
            let record = SHOWCASE[index];
            if (this.settings.sortOption == 'tokenIdAscending') {
              record.tokenIds.sort((a, b) => {
                return a - b;
              });
            } else if (this.settings.sortOption == 'tokenIdDescending') {
              record.tokenIds.sort((a, b) => {
                return b - a;
              });
            } else {
              record.tokenIds.sort(() => {
                return Math.random() - 0.5;
              });
            }
            return record;
          },
          copyCurrentFilteredResultsIntoSelection() {
            const results = {};
            for (const item of this.tokensSearchResults) {
              results[item.tokenId] = true;
            }
            this.settings.selection = results;
          },
          getImagePreview(tokenId) {
            return this.data[tokenId].images[4];
          },

          <!-- Recalculation -->
          async recalculate(from) {
            console.log(new Date().toUTCString() + " recalculate(from: " + from + ") start");

            if (from != 'selectedTags') {
              this.data = BASTARDDATA;
              this.calculateTokensOwned();
              this.calculateCategories();
            }
            this.tokensSearchResults = this.calculateSearchResults();
            this.collatedOwners = this.calculateCollatedOwners();
            console.log(new Date().toUTCString() + " recalculate(from: " + from + ") processOSData() begin");
            await this.processOSData();
            this.saveSettings();
            console.log(new Date().toUTCString() + " recalculate(from: " + from + ") processOSData() completed");
          },

          calculateTokensOwned() {
            const results = [];
            if (this.owners.length > 0 && this.account) {
              const account = this.account.toLowerCase();
              for (let i in BASTARDDATA) {
                const item = BASTARDDATA[i];
                const owner = this.owners[i];
                if (owner && owner.toLowerCase() == account) {
                  results.push(item.tokenId);
                }
              }
            }
            console.log(new Date().toUTCString() + " - calculateTokensOwned() completed: " + JSON.stringify(results));
            this.tokensOwned = results;
          },

          calculateCategories() {
            const collator = {};
            for (let i in this.data) {
              const item = this.data[i];
              for (let k in item.attributes) {
                const attribute = item.attributes[k];
                const traitType = attribute.trait_type;
                const value = attribute.value;
                if (!collator[traitType]) {
                  collator[traitType] = {};
                }
                if (!collator[traitType][value]) {
                  collator[traitType][value] = 1;
                } else {
                  collator[traitType][value] = collator[traitType][value] + 1;
                }
              }
            }
            console.log(new Date().toUTCString() + " - calculateCategories() completed");
            this.categories = collator;
          },

          calculateSearchResults() {
            const accountLowerCase = this.account == null ? null : this.account.toLowerCase();
            const selectedTags = this.selectedTags == null || (this.selectedTags.length == 1 && this.selectedTags[0] == null) ? null : this.selectedTags;

            function getAttribute(data1, category) {
              for (let attributeIndex in data1.attributes) {
                const attribute = data1.attributes[attributeIndex];
                if (attribute.trait_type == category) {
                  return attribute.value;
                }
              }
              return null;
            }

            console.log("this.tokensOwned: " + JSON.stringify(this.tokensOwned));
            let data = this.data.slice(0);
            let stage1Data = data;
            if (this.settings.searchTokenId != null && this.settings.searchTokenId.length > 0) {
              const searchTokenIds = this.settings.searchTokenId.split(",").map(function(item) { return item.trim(); });
              stage1Data = [];
              for (s of searchTokenIds) {
                var range = s.match(/(\d+)-(\d+)/)
                if (range != null) {
                  for (let i = range[1]; i <= range[2]; i++) {
                    stage1Data.push(data[i]);
                  }
                }
                if (s >= 0 && s < this.getTotalSupply) {
                  stage1Data.push(data[s]);
                }
              }
            }
            let stage2Data = stage1Data;
            if (this.settings.mySexyBastards) {
              const account = this.account.toLowerCase();
              stage2Data = [];
              for (let i in stage1Data) {
                const d = stage1Data[i];
                const owner = this.owners[d.tokenId];
                if (owner && owner.toLowerCase() == account) {
                  stage2Data.push(d);
                }
              }
            }

            let stage3Data = stage2Data;
            if (this.selectedCategories && this.selectedCategories.length > 0 && this.selectedCategories[0] != null) {
              const tokenIds = {};
              for (const selectedCategory of this.selectedCategories) {
                for (const record of CATEGORIES) {
                  if (selectedCategory == record.category) {
                    console.log(record);
                    for (const tokenId of record.tokenIds) {
                      tokenIds[tokenId] = 1;
                    }
                  }
                }
              }
              stage3Data = [];
              for (let i in stage2Data) {
                const d = stage2Data[i];
                if (tokenIds[d.tokenId]) {
                  stage3Data.push(d);
                }
              }
            }

            let stage4Data = stage3Data;
            if (this.settings.searchLyrics != null && this.settings.searchLyrics.length > 0) {
              const s = this.settings.searchLyrics.toLowerCase();
              console.log("s: " + s);
              stage4Data = [];
              for (let i in stage1Data) {
                const d = stage1Data[i];
                const include = d.description.toLowerCase().includes(s);
                if (d.description && d.description.toLowerCase().includes(s)) {
                  if (i < 10) {
                    console.log("stage1Data[" + i + "].description: " + JSON.stringify(d.description) + ", include: " + include);
                  }
                  stage4Data.push(d);
                }
              }
            }

            let stage5Data = stage4Data;
            if (this.settings.searchAccount != null && this.settings.searchAccount.length > 0) {
              const searchAccounts = this.settings.searchAccount.split(",");
              stage5Data = [];
              for (let i in stage4Data) {
                const d = stage4Data[i];
                const owner = this.owners[d.tokenId] ? this.owners[d.tokenId].toLowerCase() : null;
                const ensName = owner == null ? null : this.ensMap[owner];
                for (searchAccount of searchAccounts) {
                  const s = searchAccount.toLowerCase();
                  if (owner != null && owner.includes(s)) {
                    stage5Data.push(d);
                    break;
                  } else if (ensName != null && ensName.includes(s)) {
                    stage5Data.push(d);
                    break;
                  }
                }
              }
            }
            console.log("stage5Data.length: " + stage5Data.length);

            let results = [];
            for (let i in stage5Data) {
              const d = stage5Data[i];
              let include = true;
              for (const [key, value] of Object.entries(this.categoryFilter)) {
                const attributeValue = getAttribute(d, key);
                if (!value[attributeValue]) {
                  include = false;
                  break;
                }
              }
              if (include) {
                if (selectedTags && selectedTags.length > 0) {
                  const tags = this.tags[d.tokenId];
                  let found = false;
                  if (tags) {
                    for (const selectedTag of selectedTags) {
                      for (const tag of tags) {
                        if (selectedTag == tag) {
                          found = true;
                          break;
                        }
                      }
                    }
                  }
                  if (!found) {
                    include = false;
                  }
                }
              }
              if (include) {
                results.push(d);
              }
            }
            console.log(new Date().toUTCString() + " - calculateSearchResults() completed");
            return results;
          },

          calculateCollatedOwners() {
            let results = [];
            if (this.owners.length > 0) {
              const collator = {};
              for (let i in this.data) {
                const item = this.data[i];
                const owner = this.owners[i];
                if (!collator[owner]) {
                  collator[owner] = [];
                }
                collator[owner].push(item.tokenId);
              }
              for (const [key, value] of Object.entries(collator)) {
                results.push({ owner: key, tokens: value, count: value.length });
              }
              results.sort(function(a, b) {
                return b.count - a.count;
              });
              for (let i in results) {
                results[i].index = i;
              }
            }
            console.log(new Date().toUTCString() + " - calculateCollatedOwners() completed");
            return results;
          },

          async processOSData() {
            console.log(new Date().toUTCString() + " processOSData() start");
            var db0 = new Dexie("BastardDB");
            db0.version(1).stores({
              apiData: '&tokenId,asset,timestamp'
            });
            const osAssets = await db0.apiData.toArray();
            const osData = {};
            // console.log(JSON.stringify(osAssets[4553], null, 2));
            for (const asset of osAssets) {
              if (asset.tokenId == 1712345) {
                console.log(JSON.stringify(asset, null, 2));
              }
              let lastSale = null;
              if (asset.asset.last_sale) {
                lastSale = {
                  totalPrice: new BigNumber(asset.asset.last_sale.total_price).shift(-18),
                  symbol: asset.asset.last_sale.payment_token.symbol,
                  decimals: asset.asset.last_sale.payment_token.decimals,
                  ethPrice: asset.asset.last_sale.payment_token.eth_price,
                  usdPrice: asset.asset.last_sale.payment_token.usd_price,
                  tx: asset.asset.last_sale.transaction.transaction_hash,
                  assetBundle: asset.asset.last_sale.asset_bundle,
                  eventType: asset.asset.last_sale.event_type,
                  eventTimestamp: asset.asset.last_sale.event_timestamp,
                }
              }
              let sellOrder = null;
              if (asset.asset.sell_orders) {
                const numberSellOrders = asset.asset.sell_orders.length;
                if (numberSellOrders > 1) {
                  console.log("WARNING: numberSellOrders > 1 #" + asset.tokenId + " " + JSON.stringify(asset.asset, null, 2));
                }
                for (const so of asset.asset.sell_orders) {
                  sellOrder = {
                    basePrice: so.base_price,
                    currentPrice: new BigNumber(so.current_price).shift(-18),
                    symbol: so.payment_token_contract.symbol,
                    decimals: so.payment_token_contract.decimals,
                    ethPrice: so.payment_token_contract.eth_price,
                    usdPrice: so.payment_token_contract.usd_price,
                    cancelled: so.cancelled,
                    feeMethod: so.fee_method,
                    side: so.side,
                    saleKind: so.sale_kind,
                    createdDate: so.created_date,
                    closingDate: so.closing_date,
                    closingExtendable: so.closing_extendable,
                    expirationTime: so.expiration_time,
                    listingTime: so.listing_time,
                  };
                }
              }
              osData[asset.tokenId] = { sellOrder: sellOrder, lastSale: lastSale };
            }
            // console.log(JSON.stringify(osData, null, 8));
            this.osData = osData;
            console.log(new Date().toUTCString() + " processOSData() completed");
          },

          // --- Web3 Connection ---
          async connect() {
            if (!window.ethereum) {
              alert("Please use the https://metamask.io addon with Firefox, Chromium, Opera or Chrome, or any other other web3 browser, if you would like to view your Ethereum wallet's BGANPUNKSV2.");
              this.connected = false;
              this.account = null;
            } else {
              if (!window.ethereum.isConnected() || !window.ethereum['isUnlocked']) {
                try {
                  const t = this;
                  function handleAccountsChanged(accounts) {
                    console.log("handleAccountsChanged: " + JSON.stringify(accounts));
                    t.account = accounts[0];
                    localStorage.setItem('bastardMyAccount', JSON.stringify(t.account));
                    t.recalculate('web3 account update');
                  }
                  if (!this.connected) {
                    window.ethereum.on('accountsChanged', handleAccountsChanged);
                  }

                  const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                  this.account = accounts[0];
                  localStorage.setItem('bastardMyAccount', JSON.stringify(this.account));
                } catch (e) {
                  console.log("connect(): Error connecting");
                }
              }
              const provider = new ethers.providers.Web3Provider(window.ethereum);
              const network = await provider.getNetwork();
              if (network.chainId == 1) {
                this.connected = true;

                const yourBastardYourCall = new ethers.Contract(YOURBASTARDYOURCALLADDRESS, YOURBASTARDYOURCALLABI, provider);
                const result = await yourBastardYourCall.showLicenseForBASTARD(2, 10932);
                console.log("showLicenseForBASTARD(2, 10932): " + JSON.stringify(result));

                const erc721Helper = new ethers.Contract(ERC721HELPERADDRESS, ERC721HELPERABI, provider);
                const info = await erc721Helper.tokenInfo(BASTARDADDRESS);
                const totalSupply = parseInt(info[2].toString());
                console.log(new Date().toUTCString() + " info:" + JSON.stringify(info));
                const owners = [];
                const NFTOWNERBATCHSIZE = 500;
                for (let i = 0; i < totalSupply; i += NFTOWNERBATCHSIZE) {
                  const to = (i + NFTOWNERBATCHSIZE > totalSupply) ? totalSupply : i + NFTOWNERBATCHSIZE;
                  this.processing = "RETRIEVING LIVE BGANPUNKSV2 ONWERSHIP RECORDS FROM THE ETHEREUM MAINNET: " + ethers.utils.commify(i) + " - " + ethers.utils.commify(parseInt(to) - 1) + " OF " + ethers.utils.commify(totalSupply);
                  const ownersResult = await erc721Helper.owners(BASTARDADDRESS, i, to);
                  console.log(new Date().toUTCString() + " from: " + i + ", to: " + to + ", size: " + ownersResult[0].length);
                  for (let j = 0; j < ownersResult[0].length; j++) {
                    owners.push(ownersResult[1][j]);
                  }
                }
                this.owners = owners;
                console.log("const OWNERSSNAPSHOTTIMESTAMP=" + new Date().getTime() + ";");
                console.log("const OWNERSSNAPSHOT=" + JSON.stringify(owners) + ";");
                localStorage.setItem('bastardsOwners', JSON.stringify(owners));
                const ensMap = {};
                for (let i in owners) {
                  const owner = owners[i].toLowerCase();
                  if (!ensMap[owner]) {
                    ensMap[owner] = owners[i];
                  }
                }
                ensMap[this.account.toLowerCase()] = this.account;
                ensMap["0x000000000000000000000000000000000000dEaD".toLowerCase()] = "0DEAD_";
                ensMap["0xcCcBF11AC3030ee8CD7a04CFE15a3718df6dD030".toLowerCase()] = "NFT20_";
                let addresses = Object.keys(ensMap);
                const ensReverseRecordsContract = new ethers.Contract(ENSREVERSERECORDSADDRESS, ENSREVERSERECORDSABI, provider);
                const ENSOWNERBATCHSIZE = 500;
                for (let i = 0; i < addresses.length; i += ENSOWNERBATCHSIZE) {
                  this.processing = "RETRIEVING LIVE ENS REVERSE RECORDS FROM THE ETHEREUM MAINNET: " + ethers.utils.commify(i) + " OF " + ethers.utils.commify(addresses.length);
                  const batch = addresses.slice(i, parseInt(i) + ENSOWNERBATCHSIZE);
                  const allnames = await ensReverseRecordsContract.getNames(batch);
                  // NOT CHECKING ADDRESSES AS THE ADDRESSES CAME FROM A CONTRACT. AND account. const validNames = allnames.filter((n) => normalize(n) === n );
                  for (let j = 0; j < batch.length; j++) {
                    const address = batch[j];
                    const name = allnames[j];
                    ensMap[address] = name != null && name.length > 0 ? name : address;
                    // const normalized = normalize(address);
                  }
                }
                this.ensMap = ensMap;
                console.log("const ENSMAPSNAPSHOTTIMESTAMP=" + new Date().getTime() + ";");
                console.log("const ENSMAPSNAPSHOT=" + JSON.stringify(ensMap) + ";");
                localStorage.setItem('bastardsENSMap', JSON.stringify(ensMap));
                this.processing = "RECALCULATING DATA";
                this.recalculate('data loaded via web3');
                this.processing = null;
              } else {
                alert("Please switch to the Ethereum mainnet and refresh");
              }
            }
          },
          disconnect() {
            this.connected = false;
          },

          // --- OS Data Retrieval ---
          async loadOSData() {
            console.log(new Date().toUTCString() + " loadOSData() start");
            var db0 = new Dexie("BastardDB");
            db0.version(1).stores({
              apiData: '&tokenId,asset,timestamp'
            });
            const timestamp = parseInt(new Date() / 1000);
            const BATCHSIZE = 30; // Max 30
            const DELAYINMILLIS = 100;
            let page = 0;
            const records = [];
            const delay = ms => new Promise(res => setTimeout(res, ms));
            await delay(DELAYINMILLIS);
            const to = this.getTotalSupply;
            for (let i = 0; i < to; i += BATCHSIZE) {
              let url = "https://api.opensea.io/api/v1/assets?asset_contract_address=" + BASTARDADDRESS + "\&order_direction=desc\&limit=50\&offset=0";
              for (let j = i; j < i + BATCHSIZE && j < to; j++) {
                url = url + "&token_ids=" + j;
              }
              const elapsed = parseInt(new Date() / 1000) - timestamp;
              this.processing = "DOWNLOADING LIVE DATA FROM OPENSEA: " + ethers.utils.commify(i) + " (BATCH SIZE " + BATCHSIZE + ") OF " + ethers.utils.commify(this.getTotalSupply) + ". ELAPSED " + elapsed + " SECONDS. CONTINUE BROWSING THE BEAUTIFUL BASTRADS IN THE MEANTIME";
              const data = await fetch(url).then(response => response.json());
              if (data.assets && data.assets.length > 0) {
                for (let assetIndex = 0; assetIndex < data.assets.length; assetIndex++) {
                  const asset = data.assets[assetIndex];
                  records.push({ tokenId: asset.token_id, asset: asset, timestamp: timestamp });
                }
              }
              await delay(DELAYINMILLIS);
              await db0.apiData.bulkPut(records).then (function(){
              }).catch(function(error) {
                console.log("error: " + error);
              });
            }
            this.recalculate('loaded os data');
            this.processing = null;
            console.log(new Date().toUTCString() + " loadOSData() completed");
          },

          // --- GIF Frame Extraction ---
          async displayToken(tokenId) {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', this.data[tokenId].images[0]);
            const t = this;
            xhr.onload = function() {
              if (xhr.response.substring(0, 3) == "GIF") {
                t.selectedItemIsGIF = true;
              } else {
                t.selectedItemIsGIF = false;
              }
              t.selectedTokenId = tokenId;
              t.$refs['gif-frame-extraction-modal'].show();
            }
            xhr.onerror = function() {
              alert('A network error occurred!');
            };
            xhr.send();
          },
          async onGIFFrameSelectionModalOpened() {
            const t = this;
            var element = document.getElementById("thegif1")
            if (t.selectedItemIsGIF) {
              this.selectedItemGIF = new SuperGif({ gif: element, loop_delay: 2000, max_width: 600, rubbable: true });
              this.selectedItemGIF.load(function(){
                t.selectedItemFrames = t.selectedItemGIF.get_length();
                if (t.selectedItemFrame < 0 || t.selectedItemFrame >= t.selectedItemFrames) {
                  t.selectedItemFrame = 0;
                }
                t.selectedItemGIF.move_to(t.selectedItemFrame);
              });
            }
          },
          setFrame() {
            if (this.selectedItemGIF) {
              this.selectedItemGIF.move_to(this.selectedItemFrame);
            }
          },

          // --- UI Misc ---
          filterChange(category, option) {
            if (!this.categoryFilter[category]) {
              Vue.set(this.categoryFilter, category, {});
            }
            if (this.categoryFilter[category][option]) {
              Vue.delete(this.categoryFilter[category], option);
              if (Object.keys(this.categoryFilter[category]) == 0) {
                Vue.delete(this.categoryFilter, category);
              }
            } else {
              Vue.set(this.categoryFilter[category], option, true);
            }
            this.categoryFilter = this.categoryFilter;
            this.recalculate('filterChange');
          },
          getSortedValuesForCategory(category) {
            const results = [];
            for (let categoryKey in this.categories[category]) {
              const c = this.categories[category][categoryKey];
              results.push({ categoryOption: categoryKey, categoryTotal: c })
            }
            results.sort(function(a, b) {
              return b.categoryTotal - a.categoryTotal;
            });
            return results;
          },

          // --- Utilities ---
          getURL(s) {
            const separator = window.location.href.indexOf("/#/");
            // if (separator > 0) {
            //   const parameter = window.location.href.substring(separator + 3);
            // const prefix = window.location.href.substring(separator + 3);
            return s;
          },
          formatETH(e) {
            try {
              return e ? ethers.utils.commify(e.toString()) : null;
            } catch (err) {
            }
            return e.toFixed(9);
          },
          formatDate(d) {
            if (d == 0) {
              return "";
            } else {
              if (new RegExp('^[0-9]+$').test(d)) {
                return new Date(parseInt(d) * 1000).toDateString().substring(4);
              } else {
                return new Date(d).toDateString().substring(4);
              }
            }
          },
          saveNotes() {
            // for (const [key, value] of Object.entries(this.notes)) {
            //   if (value.length == 0) {
            //     Vue.delete(this.notes, key);
            //   }
            // }
            localStorage.setItem('bastardsNotes', JSON.stringify(this.notes));
          },
          saveTags() {
            for (const [key, value] of Object.entries(this.tags)) {
              if (value.length == 0) {
                Vue.delete(this.tags, key);
              }
            }
            localStorage.setItem('bastardsTags', JSON.stringify(this.tags));
          },
          saveSettings() {
            localStorage.setItem('bastardsSettings', JSON.stringify(this.settings));
          },
          saveGroups() {
            localStorage.setItem('bastardGroups', JSON.stringify(this.groups));
          },
          newGroup() {
            this.groups.push( { name: "", notes: "", accounts: [], active: true } );
            this.saveGroups('newGroup');
          },
          deleteGroup(index) {
            console.log("deleteGroup(" + index + ")");
            this.groups.splice(index, 1);
            this.saveGroups('deleteGroup');
          },
          newAccount(group) {
            group.accounts.push( { name: "", account: "", filterInOut: null, filter: "", active: true } );
            this.saveGroups('newAccount');
          },
          deleteAccount(group, index) {
            console.log("deleteAccount(" + JSON.stringify(group) + ", " + index + ")");
            group.accounts.splice(index, 1);
            this.saveGroups('deleteAccount');
          },
          ensOrShortName(address, length = 16) {
            try {
              let name = this.ensMap[address.toLowerCase()];
              if (name != null) {
                name = name.substring(0, length);
              }
              return name;
            } catch (e) {
              return address;
            }
          },
        },

        // --- Mounted ---
        mounted() {
          if (localStorage.getItem('bastardsOwners')) {
            this.owners = JSON.parse(localStorage.getItem('bastardsOwners'));
          } else {
            this.owners = OWNERSSNAPSHOT;
          }
          if (localStorage.getItem('bastardMyAccount')) {
            this.account = JSON.parse(localStorage.getItem('bastardMyAccount'));
          }
          if (localStorage.getItem('bastardGroups')) {
            this.groups = JSON.parse(localStorage.getItem('bastardGroups'));
          }
          if (localStorage.getItem('bastardsENSMap')) {
            this.ensMap = JSON.parse(localStorage.getItem('bastardsENSMap'));
          } else {
            this.ensMap = ENSMAPSNAPSHOT;
          }
          if (localStorage.getItem('bastardsTags')) {
            this.tags = JSON.parse(localStorage.getItem('bastardsTags'));
          }
          if (localStorage.getItem('bastardsNotes')) {
            this.notes = JSON.parse(localStorage.getItem('bastardsNotes'));
          }
          if (localStorage.getItem('bastardsSettings')) {
            const savedSettings = JSON.parse(localStorage.getItem('bastardsSettings'));
            if (savedSettings.sortOption != null) {
              this.settings = savedSettings;
            }
          }
          const separator = window.location.href.indexOf("/#/");
          if (separator > 0) {
            const parameter = window.location.href.substring(separator + 3);
            if (new RegExp('^[0-9,]+$').test(parameter)) {
              this.settings.searchTokenId = parameter;
            } else {
              this.settings.searchAccount = parameter;
            }
          }
          this.recalculate("mounted");
        }
      })
    </script>
  </body>
</html>
